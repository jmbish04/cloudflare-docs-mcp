# Task 2: Implement Cloudflare Docs Tool Adapter

## Objective
Create a robust and reusable tool adapter for the Cloudflare Docs search API, integrating it into the agentic framework.

## Context
The `feature/vision-refactor` branch introduced a placeholder `BrowserRender` class in `src/tools/browser.ts`. We need a similar, dedicated tool for searching the Cloudflare documentation. This tool will be a primary instrument for the research agent.

## Requirements

### 1. Create the Tool File
- Create a new file: `src/tools/cloudflare_docs.ts`.
- In this file, define a `CloudflareDocsTool` class.

### 2. Implement the `CloudflareDocsTool` Class
- The class should have a constructor that accepts any necessary API keys or environment bindings.
- The primary method should be `search(query: string): Promise<SearchResults>`.
- This method will be responsible for calling the Cloudflare Docs search endpoint. You can use the `@cloudflare/ai-sdk` or a direct `fetch` call.
- Define a `SearchResults` interface to strongly type the response from the search API (e.g., `title`, `url`, `contentSnippet`).

### Example `CloudflareDocsTool` (`cloudflare_docs.ts`):

```typescript
// src/tools/cloudflare_docs.ts

import { Ai } from '@cloudflare/ai';

// --- Interfaces ---
export interface SearchResult {
  url: string;
  title: string;
  contentSnippet: string;
  score: number;
}

export interface SearchResults {
  results: SearchResult[];
  totalResults: number;
}

// --- CloudflareDocsTool Class ---
export class CloudflareDocsTool {
  private ai: Ai;

  constructor(aiBinding: any) {
    this.ai = new Ai(aiBinding);
  }

  /**
   * Searches the Cloudflare documentation using a vector search model.
   * @param query The search query.
   * @returns A promise that resolves to the search results.
   */
  async search(query: string): Promise<SearchResults> {
    // Note: The specific model and API call may need to be updated based on
    // the latest Cloudflare AI SDK capabilities for RAG/search.
    // This is a conceptual example.
    const embeddings = await this.ai.run('@cf/baai/bge-base-en-v1.5', { text: [query] });
    const vectors = embeddings.data[0];

    // In a real scenario, you would query a Vectorize index.
    // For this task, you may need to call a specific internal search API
    // if one is available, or simulate it if not.
    // The key is to encapsulate the logic here.

    console.log(`Searching Cloudflare Docs for: "${query}"`);

    // Placeholder implementation:
    const mockResults: SearchResult[] = [
      { url: 'https://developers.cloudflare.com/workers/', title: 'Cloudflare Workers', contentSnippet: 'An overview of Cloudflare Workers...', score: 0.9 },
      { url: 'https://developers.cloudflare.com/d1/', title: 'Cloudflare D1', contentSnippet: 'Cloudflare D1 is a serverless database...', score: 0.85 },
    ];

    return {
      results: mockResults,
      totalResults: mockResults.length,
    };
  }
}
```

### 3. Integrate the Tool into `ChatSessionActor`
- Open `src/actors/ChatSessionActor.ts`.
- Import the new `CloudflareDocsTool`.
- Instantiate it in the actor's constructor, passing the required environment binding.
- Add a new `case` to the `executeTool` method's `switch` statement to handle calls for `'cloudflare_docs'`.

### Example `ChatSessionActor.ts` Integration:

```typescript
// src/actors/ChatSessionActor.ts
import { CloudflareDocsTool } from '../tools/cloudflare_docs';
// ... other imports

export class ChatSessionActor {
  // ... properties
  private cloudflareDocs: CloudflareDocsTool;

  constructor(state: DurableObjectState, env: Bindings) {
    // ... other tool instantiations
    this.cloudflareDocs = new CloudflareDocsTool(env.AI);
  }

  // ... other methods

  private async executeTool(toolName: string, args: any): Promise<any> {
    switch (toolName) {
      // ... other cases
      case 'cloudflare_docs':
        return this.cloudflareDocs.search(args.query);
      default:
        return { error: `Tool ${toolName} not found.` };
    }
  }
}
```

## Acceptance Criteria
- The `src/tools/cloudflare_docs.ts` file exists and contains a functional `CloudflareDocsTool` class.
- The `ChatSessionActor` is able to instantiate and successfully call the `search` method on the `CloudflareDocsTool`.
- The research plan generated by the agent can now include `'cloudflare_docs'` as a required tool.
